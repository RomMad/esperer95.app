 {% extends "model/collapseCard.html.twig" %}

 {% set id = "listservices" %}

 {% block card_title %}Indicateurs par service{% endblock %}

 {% block card_body %}

    <div class="row">
        <div class="col-md-12 table-responsive">
            <table id="table-notes" class="table table-striped table-hover text-dark">
                <thead>
                    <tr>
                        <th scope="row" class="align-middle th-w-150">Services</th>
                        <th class="align-middle text-right th-w-100">Nb de suivis en cours</th>
                        <th class="align-middle text-right th-w-100">Nb de personnes</th>
                        <th class="align-middle text-right th-w-100">Moyenne suivis/TS</th>
                        <th class="align-middle text-right th-w-100">Dur√©e moyenne accompagnement</th>
                        <th class="align-middle text-right th-w-100">Nb de demandes SIAO</th>
                        <th class="align-middle text-right th-w-100">Nb de DLS</th>
                        <th class="align-middle text-right th-w-100">Nb de notes</th>
                        <th class="align-middle text-right th-w-100">Nb de rendez-vous</th>
                        <th class="align-middle text-right th-w-100">Nb de documents</th>
                        <th class="align-middle text-right th-w-100">Nb de paiements</th>
                    </tr>
                </thead>
                <tbody>
                {% set sumActiveSupports = 0 %}
                {% set sumActiveSupportsPeople = 0 %}
                    {% for service in servicesIndicators %}  
                        {% set activeSupports = service["activeSupportsGroups"] %}
                        {% if activeSupports %}
                            {% set sumActiveSupports = sumActiveSupports + activeSupports %}
                            {% set sumActiveSupportsPeople = sumActiveSupportsPeople + service["activeSupportsPeople"] %}
                            <tr>
                                <td scope="row" class="align-middle font-weight-bold ">{{ service["name"] }}</td>
                                <td class="align-middle text-right">{{ activeSupports|number_format(0, ",", " ") }}</td>
                                <td class="align-middle text-right">{{ service["activeSupportsPeople"]|number_format(0, ",", " ") }}</td>
                                <td class="align-middle text-right">{{ service["avgSupportsByUser"] }}</td>
                                <td class="align-middle text-right">{{ service["avgTimeSupport"] }} jours</td>
                                <td class="align-middle text-right">{{ service["siaoRequest"]|number_format(0, ",", " ") }}<br/>
                                    <span class="text-secondary font-italic">{{ activeSupports ? 
                                        ((service["siaoRequest"] / activeSupports) * 100)|round(1, "common") ~ "%" }}
                                    </span>
                                </td>
                                <td class="align-middle text-right">{{ service["socialHousingRequest"] }}<br/>
                                    <span class="text-secondary font-italic">{{ activeSupports ? 
                                        ((service["socialHousingRequest"] / activeSupports) * 100)|round(1, "common") ~ "%" }}
                                    </span>
                                </td>
                                <td class="align-middle text-right">{{ service["notes"]|number_format(0, ",", " ") }}</td>
                                <td class="align-middle text-right">{{ service["rdvs"]|number_format(0, ",", " ") }}</td>
                                <td class="align-middle text-right">{{ service["documents"]|number_format(0, ",", " ") }}</td>
                                <td class="align-middle text-right">{{ service["contributions"]|number_format(0, ",", " ") }}</td>
                            </tr>
                            {% for subService in service.subServices %}
                                {% set activeSupports = subService["activeSupportsGroups"] %}
                                <tr class="text-secondary">
                                    <td scope="row" class="align-middle">- {{ subService["name"] }}</td>
                                    <td class="align-middle text-right">{{ activeSupports }}</td>
                                    <td class="align-middle text-right">{{ subService["activeSupportsPeople"] }}</td>
                                    <td class="align-middle text-right">{{ subService["avgSupportsByUser"] }}</td>
                                    <td class="align-middle text-right">{{ subService["avgTimeSupport"] }} jours</td>
                                    <td class="align-middle text-right">{{ subService["siaoRequest"] }}<br/>
                                        <span class="text-secondary font-italic">{{ activeSupports ? 
                                            ((subService["siaoRequest"] / activeSupports) * 100)|round(1, "common") ~ "%" }}
                                        </span>
                                    </td>
                                    <td class="align-middle text-right">{{ subService["socialHousingRequest"] }}<br/>
                                        <span class="text-secondary font-italic">{{ activeSupports ? 
                                            ((subService["socialHousingRequest"] / activeSupports) * 100)|round(1, "common") ~ "%" }}
                                        </span>
                                    </td>
                                    <td class="align-middle text-right">{{ subService["notes"]|number_format(0, ",", " ") }}</td>
                                    <td class="align-middle text-right">{{ subService["rdvs"]|number_format(0, ",", " ") }}</td>
                                    <td class="align-middle text-right">{{ subService["documents"]|number_format(0, ",", " ") }}</td>
                                    <td class="align-middle text-right">{{ subService["contributions"]|number_format(0, ",", " ") }}</td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                </tbody>
                    <tfooter>
                        <tr class="font-weight-bold">
                            <td class="align-middle text-center">Total</td>
                            <td class="align-middle text-right">{{ sumActiveSupports|number_format(0, ",", " ") }}</td>
                            <td class="align-middle text-right">{{ sumActiveSupportsPeople|number_format(0, ",", " ") }}</td>
                            <td class="align-middle text-right"></td>
                            <td class="align-middle text-right"></td>
                            <td class="align-middle text-right"></td>
                            <td class="align-middle text-right"></td>
                            <td class="align-middle text-right"></td>
                            <td class="align-middle text-right"></td>
                            <td class="align-middle text-right"></td>
                        </tr>
                    </tfooter>
            </table>
        </div>
    </div>

 {% endblock %}