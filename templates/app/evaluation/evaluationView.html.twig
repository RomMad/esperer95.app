{% import "macros/viewDiv.html.twig" as divElt %}

{% set ROLE_CHILD = constant("App\\Entity\\RolePerson::ROLE_CHILD") %}
{% set YES = constant("App\\Form\\Utils\\Choices::YES") %}
{% set IN_PROGRESS = constant("App\\Form\\Utils\\Choices::IN_PROGRESS") %}

{% set eval_people = evaluation.evaluationPeople %}
{% set eval_adults = evaluation.evaluationPeople|filter(e => e.supportPerson.role != ROLE_CHILD) %}
{% set eval_children = eval_people|filter(e => e.supportPerson.role == ROLE_CHILD) %}
{% set people_over_18 = eval_people|filter(e => e.supportPerson.person.age >= 18) %}
{% set nb_people = support.supportPeople|length %}

{% apply spaceless %}

    <div class="row mb-2">
        {{ divElt.get(support.groupPeople.familyTypologyToString ~ (nb_people > 1 ? ", " ~ nb_people ~ " personnes"), "Family typology") }}
    </div>

    <div class="row mb-2">
        <div class="col-12 col-lg-10">
            <div class="table-responsive">
                <table class="table table-sm table-bordered table-hover">
                    <thead>
                        <tr>
                            <th scope="col">Nom et prénom</th>
                            <th>Date de naissance</th>
                            <th class="d-none d-sm-table-cell">Âge</th>
                            <th>Sexe</th>
                            <th>Rôle</th>
                            <th>Téléphone</th>
                            <th class="d-none d-sm-table-cell">Adresse email</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for supportPerson in support.supportPeople %}
                            <tr>
                                <td scope="row" class="align-middle">
                                    {{ supportPerson.person.fullname }}
                                    {{ supportPerson.person.usename ? " (" ~ supportPerson.person.usename ~ ")" }}
                                </td>
                                <td class="align-middle">{{ supportPerson.person.birthdate|date("d/m/Y") }}</td>
                                <td class="align-middle d-none d-sm-table-cell">{{ supportPerson.person.age }} an<!--
                                    -->{{ supportPerson.person.age > 1 ? "s" }}</td>
                                <td class="align-middle">{{ supportPerson.person.genderToString }}</td>
                                <td class="align-middle">{{ supportPerson.roleToString }}</td>
                                <td class="align-middle">{{ supportPerson.person.phone1 }}</td>
                                <td class="align-middle d-none d-sm-table-cell">{{ supportPerson.person.email }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    {# Justice #}
    {% if support.service.justice == YES %}
        <hr/>
        <section>
            <div class="d-flex mb-3">
                <h2 class="h4">Justice</h2>
                    <span class="align-content-center"><a href="{{ path('support_evaluation_show', {'id': support.id }) }}" 
                        class="text-{{ theme_color }} ml-2" title="Modifier l'évaluation sociale"><span class="fas fa-edit"></span></a>
                    </span>
            </div>

            {% set eval_people_justice = eval_people|filter(e => e.evalJusticePerson) %}
            {% for evalPerson in eval_people_justice %}
                {% set evalJustice = evalPerson.evalJusticePerson %}
                <div class="my-3">
                    {% if nb_people > 1 %}
                        <div class="row mb-2">
                            <div class="col-md-12"><b>{{ evalPerson.supportPerson.person.fullname }}</b></div>
                        </div>
                    {% endif %}
                    <div class="row">
                        {{ divElt.get(evalJustice.justiceStatusToString, "Justice status", "evaluation") }}
                        {{ divElt.get(evalJustice.justiceActToString, "Justice act", "evaluation") }}
                    </div>
                    <div class="row my-2">
                        <div class="col-md-12 justify">{{ evalJustice.commentEvalJustice }}</div>
                    </div>
                </div>
            {% endfor %}
            
        </section>
    {% endif %}

    <hr/>

    {# Identité - Papier #}
    <section>
        <div class="d-flex mb-3">
            <h2 class="h4">Identité - Papier</h2>
            <span class="align-content-center"><a href="{{ path('support_evaluation_show', {'id': support.id }) }}" 
                class="text-{{ theme_color }} ml-2" title="Modifier l'évaluation sociale"><span class="fas fa-edit"></span></a>
            </span>
        </div>

        {% set eval_adults_admin = eval_adults|filter(e => e.evalProfPerson) %}
        {% set nb_adults_admin = eval_adults_admin|length %}
        {% for evalPerson in eval_adults_admin %}
            {% set evalAdm = evalPerson.evalAdmPerson %}
            <div class="my-3">
                {% if nb_adults_admin > 1 %}
                    <div class="row mb-2">
                        <div class="col-md-12"><b>{{ evalPerson.supportPerson.person.fullname }}</b></div>
                    </div>
                {% endif %}
                <div class="row">
                    {{ divElt.get(evalAdm.nationality ? evalAdm.nationalityToString ~ (evalAdm.country ? ' (' 
                        ~ evalAdm.country ~ ')' : "") : "", "Nationality", "evaluation") }}
                    {{ divElt.get(evalAdm.arrivalDate ? evalAdm.arrivalDate|date("d/m/Y"), "Arrival date", "evaluation") }}
                    {{ divElt.get(evalAdm.paper == YES and evalAdm.paperType ? evalAdm.paperTypeToString : evalAdm.paperToString, "Paper", "evaluation") }}
                    {{ divElt.get(evalAdm.asylumBackground == YES ? (evalAdm.asylumStatus ? evalAdm.asylumStatusToString : 
                        evalAdm.asylumBackgroundToString), "Asylum background", "evaluation") }}
                    {{ divElt.get(evalAdm.renewalPermitDate ? evalAdm.renewalPermitDate|date("d/m/Y") 
                        ~ (evalAdm.nbRenewals ? " (" ~ evalAdm.nbRenewals ~ " renouvellement(s))") : "", "Renewal permit date", "evaluation") }}
                    {{ divElt.get(evalAdm.endValidPermitDate ? evalAdm.endValidPermitDate|date("d/m/Y") : "", "End valid permit date", "evaluation") }}
                    {{ divElt.get(evalAdm.workRightToString, "Work right", "evaluation") }}
                </div>
                <div class="row my-2">
                    <div class="col-md-12 justify">{{ evalAdm.commentEvalAdmPerson }}</div>
                </div>
            </div>
        {% endfor %}

        {% if eval_children|filter(e => e.evalAdmPerson)|length > 0 %} {# si typologie familiale avec enfants #}
            <div class="row my-3">
                <div class="col-md-6 table-responsive">
                    <table class="table table-sm table-bordered table-hover">
                        <thead>
                            <tr>
                                <th scope="col">Enfants</th>
                                <th>Nationalité</th>
                                <th>Papier</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for evalPerson in eval_children %}
                                {% set evalAdm = evalPerson.evalAdmPerson %}
                                {% if evalAdm %}
                                    <tr>
                                        <td scope="row">{{ evalPerson.supportPerson.person.fullname }}</td>
                                        <td>{{ evalAdm.nationalityToString }}</td>
                                        <td>{{ evalAdm.paperType ? evalAdm.paperTypeToString : evalAdm.paperToString }}</td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% endif %}
    </section>

    <hr/>

    {# Famille #}
    <section>
        <div class="d-flex mb-3">
            <h2 class="h4">Famille</h2>
            <span class="align-content-center"><a href="{{ path('support_evaluation_show', {'id': support.id }) }}" 
                class="text-{{ theme_color }} ml-2" title="Modifier l'évaluation sociale"><span class="fas fa-edit"></span></a>
            </span>
        </div>

        {% set eval_adults_family = eval_adults|filter(e => e.evalFamilyPerson) %}
        {% set nb_adults_family = eval_adults_family|length %}
        {% for evalPerson in eval_adults_family %}
            {% set evalFamily = evalPerson.evalFamilyPerson %}
                {% if nb_adults_family > 1 %}
                <div class="row mb-2">
                    <div class="col-md-12 font-weight-bold">{{ evalPerson.supportPerson.person.fullname }}</div>
                </div>
                {% endif %}
            <div class="my-3">
                <div class="row mb-2">
                    {{ divElt.get(evalFamily.maritalStatusToString, "Marital status", "evaluation") }}
                    {{ divElt.get(evalFamily.noConciliationOrderToString, "No conciliation order", "evaluation") }}
                    {{ divElt.get(evalFamily.protectiveMeasure == YES and evalFamily.protectiveMeasureType ? 
                        evalFamily.protectiveMeasureTypeToString : "", "Protective measure", "evaluation") }}
                    {{ divElt.get(evalFamily.unbornChild == YES ? evalFamily.unbornChildToString ~ (evalFamily.expDateChildbirth ? " (" 
                        ~ evalFamily.expDateChildbirth|date("d/m/Y") ~ ")" : "") : "", "Unborn child", "evaluation") }}
                </div>
                <div class="row my-2">
                    <div class="col-md-12 justify">{{ evalFamily.commentEvalFamilyPerson }}</div>
                </div>
            </div>
        {% endfor %}

        {% set eval_children_family = eval_children|filter(e => e.evalFamilyPerson) %}
        {% if eval_children_family|length > 0 %}
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">Enfant(s)</th>
                                    <th>Garde ou scolarité</th>
                                    <th>Lieu de garde/scolarité</th>
                                    <th>Hébergement</th>
                                    <th>À charge</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for evalPerson in eval_children_family %}
                                    {% set evalFamilyPerson = evalPerson.evalFamilyPerson %}
                                    <tr>
                                        <td scope="row">{{ evalPerson.supportPerson.person.fullname }}</td>
                                        <td>{{ evalFamilyPerson.childcareSchoolToString }}</td>
                                        <td>{{ evalFamilyPerson.childcareSchoolLocation }}</td>
                                        <td>{{ evalFamilyPerson.childToHostToString }}</td>
                                        <td>{{ evalFamilyPerson.childDependanceToString }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        {% endif %}

        {% set evalFamily = evaluation.evalFamilyGroup %}
        {% if evalFamily %}
            <div class="row mb-2">
                {{ divElt.get(evalFamily.cafId, "Caf id", "evaluation") }}
                {{ divElt.get(evalFamily.nbDependentChildren, "Nb dependent children", "evaluation") }}
                {{ divElt.get(evalFamily.famlReunification == YES ? evalFamily.famlReunificationToString ~ (evalFamily.nbPeopleReunification ? " (" 
                    ~ evalFamily.nbPeopleReunification ~ " personne(s))" : "") : "", "Faml reunification", "evaluation") }}
            </div>
            <div class="row my-3">
                <div class="col-md-12 justify">{{ evaluation.evalFamilyGroup.commentEvalFamilyGroup }}</div>
            </div>
        {% endif %}

    </section>

    {# Budget #}
    {% set eval_people_budget = eval_people|filter(e => e.evalBudgetPerson) %}
    {% set nb_people_budget = eval_people_budget|length %}
    {% set evalBudgetGroup = evaluation.evalBudgetGroup %}
    {% if evalBudgetGroup %}
        <hr/>
        <section>
            <div class="d-flex mb-3">
                <h2 class="h4">Budget</h2>
                <span class="align-content-center"><a href="{{ path('support_evaluation_show', {'id': support.id }) }}" 
                    class="text-{{ theme_color }} ml-2" title="Modifier l'évaluation sociale"><span class="fas fa-edit"></span></a>
                </span>
            </div>
            {% if nb_people_budget > 1 %}           
                <div class="row mb-1">
                    <div class="col-md-6">
                        <table class="table table-sm table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th class="text-right">Montant</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td scope="row">Ressources</td>
                                    <td class="text-right">{{ evalBudgetGroup.resourcesGroupAmt|number_format(0, ",", " ") }} €</td>
                                </tr>
                                {% if evalBudgetGroup.chargesGroupAmt %}
                                <tr>
                                    <td scope="row">Charges</td>
                                    <td class="text-right">{{ evalBudgetGroup.chargesGroupAmt|number_format(0, ",", " ") }} €</td>
                                </tr>
                                {% endif %}
                            {% if evalBudgetGroup.debtsGroupAmt and evalBudgetGroup.monthlyRepaymentAmt > 0 %}
                                <tr>
                                    <td scope="row">Remboursement mensuel des dettes</td>
                                    <td class="text-right">{{ evalBudgetGroup.monthlyRepaymentAmt|number_format(0, ",", " ") }} €</td>
                                </tr>
                                {% endif %}
                            </tbody>
                            <tfoot>
                                <tr class="font-weight-bold">
                                    <td scope="row">Reste à vivre</td>
                                    <td class="text-right">{{ evalBudgetGroup.budgetBalanceAmt|number_format(0, ",", " ") }} €</td>
                                </tr>
                                {% if evalBudgetGroup.debtsGroupAmt %}
                                <tr>
                                    <td scope="row">Montant total des dettes</td>
                                    <td class="text-right">{{ evalBudgetGroup.debtsGroupAmt|number_format(0, ",", " ") }} €</td>
                                </tr>
                                {% endif %}
                            </tfoot>
                        </table>
                    </div>
                </div>
            {% endif %}

            {% for evalPerson in eval_people_budget %}
                {% set evalBudget = evalPerson.evalBudgetPerson %}
                <div class="my-3">
                    {% if nb_people_budget > 1 %}
                        <div class="row mb-2">
                            <div class="col-md-12"><b>{{ evalPerson.supportPerson.person.fullname }}</b></div>
                        </div>
                    {% endif %}
                    <div class="row">
                            {{ evalBudget.resources == YES and evalBudget.resourcesAmt > 0 ? '' : 
                                divElt.get(evalBudget.resourcesToString, "Resources", "evaluation") }}
                            {# {{ evalBudget.charges == YES and evalBudget.chargesAmt > 0 ? '' : 
                                divElt.get(evalBudget.chargesToString, "Charges", "evaluation") }} #}
                    </div>
                    <div class="row">
                        {% if evalBudget.resources == YES %}
                            <div class="col-md-6">
                                <table class="table table-sm table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th scope="col">Ressources</th>
                                            <th class="text-right">Montant</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for key, value in evalBudget.resourcesType %}
                                            {% if attribute(evalBudget, key) %}
                                            <tr>
                                                <td scope="row">{% if not loop.last %}{{ value }}{% else %}
                                                    {{ attribute(evalBudget, key ~ 'Precision') ? attribute(evalBudget, key ~ 'Precision') : 
                                                        "Autre(s) ressource(s)" }}{% endif %}</td>
                                                    {% set amt = attribute(evalBudget, key ~ 'Amt')|number_format(0, ",", " ") %}
                                                <td class="text-right">{{ amt > 0 ? amt ~ ' €' }}</td>
                                            </tr>
                                            {% endif %}
                                        {% endfor %}
                                    </tbody>
                                    <tfoot>
                                        <tr class="font-weight-bold">
                                            <td scope="row">Total des ressources</td>
                                            <td class="text-right">{{ evalBudget.resourcesAmt|number_format(0, ",", " ") }} €</td>
                                        </tr>
                                        {% if evalBudget.incomeN1Amt %}
                                        <tr>
                                            <td scope="row">Impôts sur le revenu n-1</td>
                                            <td class="text-right">{{ evalBudget.incomeN1Amt|number_format(0, ",", " ") }} €</td>
                                        </tr>							
                                        {% endif %}
                                        {% if evalBudget.incomeN2Amt %}
                                        <tr>
                                            <td scope="row">Impôts sur le revenu n-2</td>
                                            <td class="text-right">{{ evalBudget.incomeN2Amt|number_format(0, ",", " ") }} €</td>
                                        </tr>
                                        {% endif %}
                                    </tfoot>
                                </table>
                            </div>
                        {% endif %}

                        {% if evalBudget.charges == YES %}
                            <div class="col-md-6">
                                <table class="table table-sm table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th scope="col">Charges</th>
                                            <td class="text-right font-weight-bold">Montant</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for key, value in evalBudget.chargesType %}
                                            {% if attribute(evalBudget, key) %}
                                            <tr>
                                                <td scope="row">{% if not loop.last %}{{ value }}{% else %}
                                                    {{ attribute(evalBudget, key ~ 'Precision') ? attribute(evalBudget, key ~ 'Precision') : 
                                                        "Autre(s) charge(s)" }}{% endif %}</td>
                                                <td class="text-right">{{ attribute(evalBudget, key ~ 'Amt')|number_format(0, ",", " ") }} €</td>
                                            </tr>
                                            {% endif %}
                                        {% endfor %}
                                    </tbody>
                                    <tfoot>
                                        <tr class="font-weight-bold">
                                            <td scope="row">Total des charges</td>
                                            <td class="text-right">{{ evalBudget.resourcesAmt|number_format(0, ",", " ") }} €</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        {% endif %}

                    </div>
                    {% if evalBudget.chargeComment %}
                    <div class="row">
                        {{ divElt.get(evalBudget.chargeComment, "Charge comment", "evaluation") }}
                    </div>
                    {% endif %}
                    <div class="row mb-2">
                        {{ divElt.get(evalBudget.resourcesComment, "Resources comment", "evaluation") }}
                    </div>
                    <div class="row mb-2">
                        {{ divElt.get(evalBudget.incomeTaxToString, "Income tax", "evaluation") }}
                    </div>
                    {% if evalBudget.debts %}
                    <div class="row mb-2">
                        {{ divElt.get(evalBudget.debtsToString, "Debts", "evaluation") }}
                        {% if evalBudget.debts == YES %}
                        <div class="col-md-6">
                            <ul class="mb-0">
                                {% for key, value in evalBudget.debtsType %}
                                    {% if attribute(evalBudget, key) %}
                                        <li>{{ value }}</li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    <div class="row mb-2">
                        {{ divElt.get(evalBudget.debtComment, "Debt comment", "evaluation") }}
                        {{ divElt.get(evalBudget.overIndebtRecord ? evalBudget.overIndebtRecordToString ~ (evalBudget.overIndebtRecordDate ? 
                            " (date de dépôt : " ~ evalBudget.overIndebtRecordDate|date("d/m/Y") ~ ")" : "") : "", "Over indebt record", "evaluation") }}
                        {{ divElt.get(evalBudget.settlementPlanToString, "Settlement plan", "evaluation") }}
                        {{ divElt.get(evalBudget.moratoriumToString, "Moratorium", "evaluation") }}
                        {{ divElt.get(evalBudget.endRightsDate ? evalBudget.endRightsDate|date("d/m/Y") : "", "End rights date", "evaluation") }}
                    </div>
                    {% endif %}
                    {% if evalBudget.commentEvalBudget %}
                        <div class="row my-3">
                            <div class="col-md-12 justify">{{ evalBudget.commentEvalBudget }}</div>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </section>
    {% endif %}

    <hr/>

    {# Emploi #}
    <section>
        <div class="d-flex mb-3">
            <h2 class="h4">Emploi</h2>
            <span class="align-content-center"><a href="{{ path('support_evaluation_show', {'id': support.id }) }}" 
                class="text-{{ theme_color }} ml-2" title="Modifier l'évaluation sociale"><span class="fas fa-edit"></span></a>
            </span>
        </div>

        {% set eval_adults_prof = eval_adults|filter(e => e.evalProfPerson) %}
        {% set nb_adults_prof = eval_adults_prof|length %}
        {% for evalPerson in eval_adults_prof %}
            {% set evalProf = evalPerson.evalProfPerson %}
            <div class="my-3">
                {% if nb_adults_prof > 1 %}
                    <div class="row mb-2">
                        <div class="col-md-12"><b>{{ evalPerson.supportPerson.person.fullname }}</b></div>
                    </div>
                {% endif %}
                <div class="row mb-2">
                    {{ divElt.get(evalProf.schoolLevelToString, "School level", "evaluation") }}
                    {{ divElt.get(evalProf.profExperienceToString, "Prof experience", "evaluation") }}
                    {{ divElt.get(evalProf.profStatus ? evalProf.profStatusToString ~ (evalProf.contractType ? " (" 
                        ~ evalProf.contractTypeToString ~ ")" : "") : "", "Prof status", "evaluation") }}
                    {{ divElt.get(evalProf.jobCenterId, "Job center id", "evaluation") }}
                    {{ divElt.get(evalProf.jobType, "Job type", "evaluation") }}
                    {{ divElt.get(evalProf.contractEndDate ? evalProf.contractEndDate|date("d/m/Y"), "Contract end date", "evaluation") }}
                    {{ divElt.get(evalProf.workingHours ? evalProf.workingHours ~ (evalProf.nbWorkingHours ? " (nb d'heures : " 
                        ~ evalProf.nbWorkingHours ~ ")" : "") : "", "Working hours", "evaluation") }}
                    {{ divElt.get(evalProf.employerName ? evalProf.employerName ~ (evalProf.workPlace ? " | " 
                        ~ evalProf.workPlace : "") : "", "Employer name", "evaluation") }}
                    {{ divElt.get(evalProf.transportMeansType ? evalProf.transportMeansTypeToString ~ (evalProf.transportMeans ? " (" 
                        ~ evalProf.transportMeans ~ ")" : ""): "", "Transport means type", "evaluation") }}
                    {{ divElt.get(evalProf.rqth in [YES, IN_PROGRESS] ? evalProf.rqthToString ~ (evalProf.endRqthDate ? " (fin de validité : " 
                        ~ evalProf.endRqthDate|date("d/m/Y") ~ ")" : ""): "", "Rqth", "evaluation") }}
                </div>
                <div class="row my-2">
                    <div class="col-md-12 justify">{{ evalProf.commentEvalProf }}</div>
                </div>
            </div>
        {% endfor %}
    </section>

    <hr/>

    {# Social #}
    <section>
        <div class="d-flex mb-3">
            <h2 class="h4">Social</h2>
            <span class="align-content-center"><a href="{{ path('support_evaluation_show', {'id': support.id }) }}" 
                class="text-{{ theme_color }} ml-2" title="Modifier l'évaluation sociale"><span class="fas fa-edit"></span></a>
            </span>
        </div>

        {% set eval_people_social = eval_people|filter(e => e.evalSocialPerson) %}
        {% set nb_people_social = eval_people_social|length %}
        {% for evalPerson in eval_people_social %}
            {% set evalSocial = evalPerson.evalSocialPerson %}
            {% if evalSocial.rightSocialSecurity or evalSocial.healthProblem == YES or evalSocial.commentEvalSocialPerson  %}
                <div class="my-3">
                    {% if nb_people_social > 1 %}
                        <div class="row mb-2">
                            <div class="col-md-12"><b>{{ evalPerson.supportPerson.person.fullname }}</b></div>
                        </div>
                    {% endif %}
                    <div class="row mb-2">
                        {{ divElt.get(evalSocial.rightSocialSecurity in [1, 3] ? evalSocial.rightSocialSecurityToString ~ " - " 
                            ~ evalSocial.socialSecurityToString : evalSocial.rightSocialSecurityToString, "Right social security", "evaluation") }}
                        {{ divElt.get(evalSocial.socialSecurityOffice, "Social security office", "evaluation") }}
                        {{ divElt.get(evalSocial.childWelfareBackground == YES ? evalSocial.childWelfareBackgroundToString, "Child welfare background", "evaluation") }}
                    </div>
                    {% if evalSocial.familyBreakdown == YES or evalSocial.friendshipBreakdown == YES %}
                        <div class="row mb-2">
                            {{ divElt.get(evalSocial.familyBreakdownToString, "Family breakdown", "evaluation") }}
                            {{ divElt.get(evalSocial.friendshipBreakdownToString, "Friendship breakdown", "evaluation") }}
                        </div>
                    {% endif %}
                    {% if evalSocial.healthProblem == YES %}
                        <div class="row mb-2">
                            {{ divElt.get(evalSocial.healthProblemToString, "Health problem", "evaluation") }}
                            <div class="col-md-6">
                                <ul class="mb-0">
                                    {% for key, value in evalSocial.healthProblemsType %}
                                        {% if attribute(evalSocial, key) %}
                                            <li>{{ value }}</li>
                                        {% endif %}
                                    {% endfor %}									 
                                </ul>
                            </div>
                        </div>
                    {% endif %}
                    <div class="row mb-2">
                        {{ divElt.get(evalSocial.careSupport == YES ? evalSocial.careSupportToString ~ (evalSocial.careSupportType ? " - " 
                            ~ evalSocial.careSupportTypeToString : ""), "Care support", "evaluation") }}
                        {{ divElt.get(evalSocial.violenceVictim == YES ? evalSocial.violenceVictimToString ~ (evalSocial.domViolenceVictim == YES ? 
                            " (Violence conjugale)" : ""), "Violence victim", "evaluation") }}
                    </div>
                    {% if evalSocial.commentEvalSocialPerson %}
                        <div class="row mb-2">
                            <div class="col-md-12 justify">{{ evalSocial.commentEvalSocialPerson }}</div>
                        </div>
                    {% endif %}
                </div>
            {% endif %}
        {% endfor %}

        {% if evaluation.evalSocialGroup %}
            {% set evalSocial = evaluation.evalSocialGroup %}
            <div class="row mb-2">
                {{ divElt.get(evalSocial.reasonRequestToString, "Reason request", "evaluation") }}
                {{ divElt.get(evalSocial.wanderingTimeToString, "Wandering time", "evaluation") }}
                {{ divElt.get(evalSocial.animal == YES ? evalSocial.animalToString ~ (evalSocial.animalType ? " (" ~ evalSocial.animalType ~ ")" : "" ), "Animal", "evaluation") }}
            </div>
            <div class="row mb-2">
                <div class="col-md-12 justify">{{ evaluation.evalSocialGroup.commentEvalSocialGroup }}</div>
            </div>
        {% endif %}
    </section>

    {# Logement - Hébergement #}
    {% set evalHousing = evaluation.evalHousingGroup %}
    {% if evalHousing %}
        <hr/>
        <section class="mb-5">
            <div class="d-flex mb-3">
                <h2 class="h4">Logement - Hébergement</h2>
                <span class="align-content-center"><a href="{{ path('support_evaluation_show', {'id': support.id }) }}" 
                    class="text-{{ theme_color }} ml-2" title="Modifier l'évaluation sociale"><span class="fas fa-edit"></span></a>
                </span>
            </div>
            <div class="row mb-3">
                {{ divElt.get(evalHousing.housingStatusToString, "Housing status", "evaluation") }}
            </div>
                <div class="row mb-3">
                    {{ divElt.get(evalHousing.siaoRequestToString, "Siao request", "evaluation") }}
                    {% if evalHousing.siaoRequest == YES %}
                        {{ divElt.get(evalHousing.siaoRequestDate ? evalHousing.siaoRequestDate|date("d/m/Y") 
                            ~ (evalHousing.siaoUpdatedRequestDate ? " (actualisation : " ~ evalHousing.siaoUpdatedRequestDate|date("d/m/Y") 
                            ~ ")" : "") : "", "Siao request date", "evaluation") }}
                        {{ divElt.get(evalHousing.siaoRequestDeptToString, "Siao request dept", "evaluation") }}
                        {{ divElt.get(evalHousing.siaoRecommendationToString, "Siao recommendation", "evaluation") }}
                    {% endif %}
                </div>
            {% if evalHousing.socialHousingRequest %}
                <div class="row mb-3">
                    {{ divElt.get(evalHousing.socialHousingRequestToString ~ (evalHousing.socialHousingRequestId ? " (NUR : " 
                        ~ evalHousing.socialHousingRequestId ~ ")" : ""), "Social housing request", "evaluation") }}
                    {{ divElt.get(evalHousing.socialHousingRequestDate ? evalHousing.socialHousingRequestDate|date("d/m/Y") 
                        ~ (evalHousing.socialHousingUpdatedRequestDate ? " (actualisation : " ~ evalHousing.socialHousingUpdatedRequestDate|date("d/m/Y") 
                        ~ ")" : "") : "", "Date demande de logement social", "evaluation") }}
                    {{ divElt.get(evalHousing.housingWishes, "Housing wishes", "evaluation") }}
                    {{ divElt.get(evalHousing.citiesWishes, "Cities wishes", "evaluation") }}
                    {{ divElt.get(evalHousing.specificities, "Specificities", "evaluation") }}
                </div>
            {% endif %}
            {% if evalHousing.syplo in [YES, IN_PROGRESS] %}
                <div class="row mb-3">
                    {{ divElt.get(evalHousing.syploToString ~ (evalHousing.syploDate ? " (" 
                        ~ evalHousing.syploDate|date("d/m/Y") ~ ")" : ""), "Syplo", "evaluation") }}
                    {{ divElt.get(evalHousing.syploId, "Syplo id", "evaluation") }}
                </div>
            {% endif %}
            {% if evalHousing.daloAction in [YES, IN_PROGRESS] %}
                <div class="row mb-3">
                    {{ divElt.get(evalHousing.daloActionToString ~ (evalHousing.daloDecisionDate ? " (" 
                        ~ evalHousing.daloDecisionDate|date("d/m/Y") ~ ")"), "Dalo action", "evaluation") }}
                    {{ divElt.get(evalHousing.daloTypeToString, "Dalo type", "evaluation") }}
                    {{ divElt.get(evalHousing.daloId, "Dalo id", "evaluation") }}
                    {{ divElt.get(evalHousing.daloRecordDate ? evalHousing.daloRecordDate|date("d/m/Y"), "Dalo record date", "evaluation") }}
                    {{ divElt.get(evalHousing.daloTribunalActionToString ~ (evalHousing.daloTribunalActionDate ? 
                        " (le " ~ evalHousing.daloTribunalActionDate|date("d/m/Y") ~ ")"), "Dalo tribunal action", "evaluation") }}
                </div>
            {% endif %}
            {#{% if evalHousing.collectiveAgreementHousing %}
                <div class="row mb-3">
                    {{ divElt.get(evalHousing.collectiveAgreementHousingToString ~ (evalHousing.collectiveAgreementHousingDate ? 
                        " (le " ~ evalHousing.collectiveAgreementHousingDate|date("d/m/Y") ~ ")"), "Collective agreement housing", "evaluation") }}
                </div>
            {% endif %} #}
            {% if evalHousing.hsgActionEligibility in [YES, IN_PROGRESS] %}					
                <div class="row mb-3">
                    {{ divElt.get(evalHousing.hsgActionEligibilityToString, "Hsg action eligibility", "evaluation") }}
                    {{ divElt.get(evalHousing.hsgActionRecordToString ~ (evalHousing.hsgActionDate ? 
                        " (le " ~ evalHousing.hsgActionDate|date("d/m/Y") ~ ")"), "Hsg action record", "evaluation") }}
                    {{ divElt.get(evalHousing.hsgActionRecordId, "Hsg action record id", "evaluation") }}
                    {{ divElt.get(evalHousing.hsgActionDept, "Hsg action dept", "evaluation") }}
                </div>
            {% endif %}
            {% if evalHousing.expulsionInProgress == YES %}
                <div class="row mb-3">
                    {{ divElt.get(evalHousing.expulsionInProgressToString, "Expulsion in progress", "evaluation") }}
                    {{ divElt.get(evalHousing.publicForceToString ~ (evalHousing.publicForceDate ? 
                        " (le " ~ evalHousing.publicForceDate|date("d/m/Y") ~ ")"), "Public force", "evaluation") }}
                    {{ divElt.get(evalHousing.expulsionComment) }}
                </div>
            {% endif %}
            {% if evalHousing.housingExperience %}
                <div class="row mb-3">
                    {{ divElt.get(evalHousing.housingExperienceToString, "Housing experience", "evaluation") }}
                    {{ divElt.get(evalHousing.housingExpeComment) }}
                </div>
            {% endif %}
            <div class="row mb-3">
                <div class="col-md-6">
                    <ul class="mb-0">
                        {% for key, value in evalHousing.housingHelps %}
                            {% if attribute(evalHousing, key) %}
                                <li>{{ value }}</li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="row mb-3">
                {{ divElt.get(evalHousing.domiciliation == YES ? evalHousing.domiciliationAddress ~ (evalHousing.domiciliationCity ? " - " 
                    ~ evalHousing.domiciliationDept ~ " " ~ evalHousing.domiciliationCity : "") : "", "Domiciliation", "evaluation") }}
            </div>
            <div class="row my-3">
                <div class="col-md-12 justify">{{ evalHousing.commentEvalHousing }}</div>
            </div>

        </section>
    {% endif %}

    {# Parcours de vie #}
    {% if evaluation.backgroundPeople %}
        <hr/>
        <section class="mb-5">
            <div class="d-flex mb-3">
                <h2 class="h4">Parcours de vie</h2>
                <span class="align-content-center"><a href="{{ path('support_evaluation_show', {'id': support.id }) }}" 
                    class="text-{{ theme_color }} ml-2" title="Modifier l'évaluation sociale"><span class="fas fa-edit"></span></a>
                </span>
            </div>
            <div class="row mb-3">
                <div class="col-md-12 justify">{{ evaluation.backgroundPeople }}</div>
            </div>
        </section>
    {% endif %}

    {# Vie à l'hôtel #}
    {% set evalHotelLife = evaluation.evalHotelLifeGroup %}
    {% if evalHotelLife %}
        <hr/>
        <section class="mb-5">
            <div class="d-flex mb-3">
                <h2 class="h4">Vie à l'hôtel</h2>
                <span class="align-content-center"><a href="{{ path('support_evaluation_show', {'id': support.id }) }}" 
                    class="text-{{ theme_color }} ml-2" title="Modifier l'évaluation sociale"><span class="fas fa-edit"></span></a>
                </span>
            </div>
            {% if evalHotelLife.food %}
                <div class="row mb-3">
                    <div class="col-md-12 text-secondary">{{ "Food"|trans({}, "evaluation") }}</div>
                    <div class="col-md-12 justify">{{ evalHotelLife.food }}</div>
                </div>
            {% endif %}
            {% if evalHotelLife.clothing %}
                <div class="row mb-3">
                    <div class="col-md-12 text-secondary">{{ "Clothing"|trans({}, "evaluation") }}</div>
                    <div class="col-md-12 justify">{{ evalHotelLife.clothing }}</div>
                </div>
            {% endif %}
            {% if evalHotelLife.roomMaintenance %}
                <div class="row mb-3">
                    <div class="col-md-12 text-secondary">{{ "Room maintenance"|trans({}, "evaluation") }}</div>
                    <div class="col-md-12 justify">{{ evalHotelLife.roomMaintenance }}</div>
                </div>
            {% endif %}
            {% if evalHotelLife.otherHotelLife %}
                <div class="row mb-3">
                    <div class="col-md-12 text-secondary">{{ "Other hotel life"|trans({}, "evaluation") }}</div>
                    <div class="col-md-12 justify">{{ evalHotelLife.otherHotelLife }}</div>
                </div>
            {% endif %}
            {% if evalHotelLife.commentHotelLife %}
                <div class="row mb-3">
                    <div class="col-md-12 text-secondary">{{ "Comment hotel life"|trans({}, "evaluation") }}</div>
                    <div class="col-md-12 justify">{{ evalHotelLife.commentHotelLife }}</div>
                </div>
            {% endif %}
        </section>
    {% endif %}

{% endapply %}