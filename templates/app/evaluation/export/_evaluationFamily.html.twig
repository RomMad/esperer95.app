{% import "macros/viewParagraph.html.twig" as view_p %}
{% import "macros/viewTextArea.html.twig" as view_text %}

<hr/>
<h2 style="{{ style_h2 }}">Situation familiale</h2>

{% set eval_adults_family = eval_adults|filter(e => e.evalFamilyPerson) %}
{% set nb_adults_family = eval_adults_family|length %}
{% for evalPerson in eval_adults_family %}
    {% set evalFamily = evalPerson.evalFamilyPerson %}
    {% if nb_adults_family > 1 %}
        <p style="{{ style_h3 }}"><u>{{ evalPerson.supportPerson.person.fullname }}</u> :</p>
    {% endif %}
    {{ view_p.get(evalFamily.maritalStatusToString, "Marital status", "evaluation") }}
    {{ view_p.get(evalFamily.protectiveMeasure == YES and evalFamily.protectiveMeasureType ? 
        evalFamily.protectiveMeasureTypeToString, "Protective measure", "evaluation") }}
    {{ view_p.get(evalFamily.unbornChild == YES ? evalFamily.unbornChildToString ~ (evalFamily.expDateChildbirth ? " (" 
        ~ evalFamily.expDateChildbirth|date("d/m/Y") ~ ")"), "Unborn child", "evaluation") }}
    {{ view_text.get(evalFamily.commentEvalFamilyPerson, null, null, type) }}
{% endfor %}

{% set eval_children_family = eval_children|filter(e => e.evalFamilyPerson) %}
{% if eval_children_family|length > 0 %}
    <p>&nbsp;</p>
    <table class="table-bordered mb-2" style="width: 100%; {{ style_table }}">
        <thead>
            <tr style="background-color: #e9ecef; font-weight: bold;">
                <th>Enfant(s)</th>
                <th>Garde ou scolarité</th>
                <th>Hébergement</th>
                <th>À charge</th>
            </tr>
        </thead>
        <tbody>
            {% for evalPerson in eval_children_family %}
                {% set evalFamilyPerson = evalPerson.evalFamilyPerson %}
                {% if evalFamilyPerson %}
                    <tr>
                        <td>{{ evalPerson.supportPerson.person.fullname }}</td>
                        <td>{{ evalFamilyPerson.childcareSchoolToString }}{{ evalFamilyPerson.childcareSchoolLocation ? " (" ~ evalFamilyPerson.childcareSchoolLocation ~ ")" }}</td>
                        <td>{{ evalFamilyPerson.childToHostToString }}</td>
                        <td>{{ evalFamilyPerson.childDependanceToString }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
{% endif %}

{% set evalFamily = evaluation.evalFamilyGroup %}
{% if evalFamily %}
    <p>&nbsp;</p>
    {{ view_p.get(evalFamily.nbDependentChildren, "Nb dependent children", "evaluation") }}
    {{ view_p.get(evalFamily.famlReunification == YES ? evalFamily.famlReunificationToString ~ (evalFamily.nbPeopleReunification ? " (" 
        ~ evalFamily.nbPeopleReunification ~ " personne(s))"), "Faml reunification", "evaluation") }}
    {{ view_text.get(evaluation.evalFamilyGroup.commentEvalFamilyGroup, null, null, type) }}
{% endif %}