{% extends "base.html.twig" %}

{% form_theme form "form/bootstrap_4_horizontal.html.twig" %}

{% block title %}Évaluation sociale{{ parent() }}{% endblock %}

{% block body %}

	{% set evaluationGroup = form.vars.value %}
	{% set EDIT_MODE = form.vars.value.evalBudgetGroup ? true : false %}
	{% set ROLE_CHILD = constant("App\\Entity\\RolePerson::ROLE_CHILD") %}
	{% set YES = constant("App\\Form\\Utils\\Choices::YES") %}
	{% set people_filtered_by_age = form.evaluationPeople|filter(e => e.vars.value.supportPerson.person.age >= 16) %}
	{% set people_without_children = form.evaluationPeople|filter(e => e.vars.value.supportPerson.role != ROLE_CHILD) %}

    {# {% cache "evaluation.edit" ~ evaluationGroup.id ~ evaluationGroup.updatedAt.timestamp evaluationGroup.updatedAt.timestamp %} #}
	<div class="container">
	
		{% set typo = support.groupPeople.familyTypology %}

		{% set title = "Évaluation sociale" %}
		{% include "app/support/navSuppport.html.twig" %}

		{{ form_start(form) }}

		{% include "model/msgFlash.html.twig" %}
		<div id="js-msg-flash-content"></div>

		<div class="row my-3 align-items-center">
			<div class="col-md-8 my-1 small text-secondary">Évaluation créée le {{ evaluationGroup.createdAt|date("d/m/Y") }}
				{% if evaluationGroup.updatedAt %} (modifiée le {{ evaluationGroup.updatedAt|date("d/m/Y à H:i") }}){% endif %}
			</div>
			<div class="col-md-4 my-1">
				<div class="float-right">
					<button type="submit" name="send2" data-url="{{ path('support_evaluation_edit', {'id':support.id}) }}" 
						class="btn btn-{{ theme_color }} shadow"><span class="fas fa-save mr-2"></span>{% if EDIT_MODE %}Mettre à jour{% else %}Enregistrer{% endif %}</button>
				</div>
			</div>
		</div>

		<div class="mb-4" data-edit-mode="{% if EDIT_MODE %}true{% else %}false{% endif %}">
			{% set badgeTitle %}
				<span class="badge badge-pill badge-warning fade-out ml-2 small" data-toggle="tooltip" data-placement="bottom" 
					title="Nombre d'informations importantes non-renseignées dans le bloc"></span>
			{% endset %}
			{% include "app/evaluation/initEvaluation.html.twig" %}
			{% if support.service.justice == YES %}
				{% include "app/evaluation/evaluationJustice.html.twig" %}
			{% endif %}
			{% include "app/evaluation/evaluationSocial.html.twig" %}
			{% include "app/evaluation/evaluationAdm.html.twig" %}
			{% include "app/evaluation/evaluationFamily.html.twig" %}
			{% include "app/evaluation/evaluationProf.html.twig" %}
			{% include "app/evaluation/evaluationBudget.html.twig" %}
			{% include "app/evaluation/evaluationHousing.html.twig" %}
			{% if support.service.id == constant("App\\Entity\\Service::SERVICE_PASH_ID") %}
				{% include "app/evaluation/evaluationHotelLife.html.twig" %}
			{% endif %}
		</div>

		<div class="form-group row">
			<div class="col-md-12">
				<div class="mb-4 float-right">
					<button type="submit" name="send" data-url="{{ path('support_evaluation_edit', {'id':support.id}) }}" 
						class="btn btn-{{ theme_color }} shadow"><span class="fas fa-save mr-2"></span>{% if EDIT_MODE %}Mettre à jour{% else %}Enregistrer{% endif %}</button>
				</div>
			</div>
		</div>

		{{ form_row(form._token) }}
		{{ form_end(form, {"render_rest": false}) }}
	</div>

	{# {% endcache %} #}

{% endblock %}

{% block javascripts %}
	{{ encore_entry_script_tags("evaluation") }}
{% endblock javascripts %}
