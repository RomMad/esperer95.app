{% extends "base.html.twig" %}

{% form_theme form_search "bootstrap_4_layout.html.twig" %}

{% block title %}Redevances | {{ title_website }}{% endblock %}

{% block body %}

<div class="container">

	{% set title = "Redevances" %}
	{% include "app/support/navSuppport.html.twig" %}

	<div class="row">
		<div class="d-flex col-md-6 mb-1 align-items-center">
			<button id="js-new-contribution" class="btn btn-{{ theme_color }} btn-sm shadow mr-2" 
				data-url="{{ path('support_resources', {'id': support.id}) }}" 
				data-contribution-rate="{{ support.service.contributionRate }}" 
				data-support-start-date="{{ support.startDate ? support.startDate|date('Y-m-d') }}" 
				data-support-end-date="{{ support.endDate ? support.endDate|date('Y-m-d') }}" 
				data-placement="bottom" title="Créer une nouvelle redevance">
				<span class="fas fa-plus-square mr-2"></span>Nouvelle redevance</button>
			<div class="d-inline align-middle">Total : <!--
			--><span id="count-contributions">{{ contributions.getTotalItemCount|number_format(0,',', ' ')}}</span><!--
			--> redevance{% if contributions.getTotalItemCount > 1 %}s{% endif %}<!--
			-->{% if nbTotalContributions %} sur <span id="nb-total-contributions">{{ nbTotalContributions }}</span>{% endif %}.
				{% if sumStillDueAmt > 0 %}
					<span class="badge badge-warning">{{ sumStillDueAmt|number_format(2,',', ' ') }} € restant dus</span>
				{% endif %}
			</div>
		</div>
		<div class="col-md-6">
			<div class="navigation">{{ knp_pagination_render(contributions) }}</div>
		</div>
	</div>

	{% include "app/contribution/searchSupportContributions.html.twig" %}

	<div class="row mb-4">
		<div class="col-md-12">
			<div class="table-responsive">
				<table id="table-contributions" class="table table-striped table-bordered table-hover text-dark">
					<thead>
						<tr>
							<th scope="col" class="align-middle th-w-20"></th>
							<th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Mois concerné", "c.month") }}</th>
							<th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Type", "c.type") }}</th>
							<th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Montant dû", "c.dueAmt") }}</th>
							<th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Montant réglé", "c.paidAmt") }}</th>
							<th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Restant dû", "c.stillDueAmt") }}</th>
							<th scope="col" class="align-middle th-date">{{ knp_pagination_sortable(contributions, "Date de règlement", "c.paymentDate") }}</th>
							<th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Mode de réglement", "c.paymentType") }}</th>
							{# <th scope="col" class="align-middle th-date">{{ knp_pagination_sortable(contributions, "Caution - Date de restitution", "c.returnDate") }}</th>
							<th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Caution - Montant restitué", "c.returnAmt") }}</th> #}
							<th scope="col" class="align-middle th-w-120">{{ knp_pagination_sortable(contributions, "Commentaire", "c.comment") }}</th>
							<th scope="col" class="align-middle th-w-20"></th>
						</tr>
					</thead>
					<tbody id="container-contributions">
						{% for contribution in contributions %}
							<tr id="contribution-{{ contribution.id }}" class="js-contribution">
								<td scope="row" class="align-middle text-center">
									<button class="btn btn-{{ theme_color }} btn-sm shadow js-get" data-id="{{ contribution.id }}"
										data-placement="bottom" title="Voir la redevance"><span class="fas fa-eye"></span>
									</button>
								</td>
								<td class="align-middle js-month">{{ contribution.month|date("Y-m") }}</td>
								<td class="align-middle js-type">{{ contribution.typeToString }}</td>
								<td class="align-middle text-right js-dueAmt">{{ contribution.dueAmt|number_format(2, ",", " ") }} €</td>
								<td class="align-middle text-right js-paidAmt">{{ contribution.paidAmt|number_format(2, ",", " ") }} €</td>
								<td class="align-middle text-right js-stillDueAmt">{{ contribution.stillDueAmt|number_format(2, ",", " ") }} €</td>
								<td class="align-middle text-center js-paymentDate">{{ contribution.paymentDate ? contribution.paymentDate|date("d/m/Y") }}</td>
								<td class="align-middle js-paymentType">{{ contribution.paymentTypeToString }}</td>
								{# <td class="align-middle text-center js-returnDate">{{ contribution.returnDate ? contribution.returnDate|date("d/m/Y") }}</td>
								<td class="align-middle text-right js-returnAmt">{{ contribution.returnAmt ? contribution.returnAmt|number_format(2, ",", " ") ~ " €" }}</td> #}
								<td class="align-middle js-comment">{{ contribution.comment|slice(0,65) }}{% if contribution.comment|length > 70 %}...{% endif %}</td>
								<td class="align-middle text-center">
									<button class="js-delete btn btn-danger btn-sm shadow my-1" 
										data-url="{{ path('contribution_delete', {'id':contribution.id}) }}" 
										data-placement="bottom" title="Supprimer la redevance" 
										data-toggle="modal" data-target="#modal-block">
										<span class="fas fa-trash-alt"></span>
									</button>
								</td>
							</tr>
						{% endfor %}
					</tbody>
					<tfooter>
						<tr class="font-weight-bold">
							<td scope="row" colspan="3" class="align-middle text-center">Total </td>
							<td id="js-sumDueAmt" class="align-middle text-right"></td>
							<td id="js-sumPaidAmt" class="align-middle text-right"></td>
							<td id="js-sumStillDueAmt" class="align-middle text-right"></td>
						</tr>
					</tfooter>
				</table>
			</div>
			<div class="navigation">{{ knp_pagination_render(contributions) }}</div>
		</div>
	</div>

</div>

{% include "app/contribution/modalContribution.html.twig" %}
{% include "app/contribution/modalDeleteContribution.html.twig" %}

{% endblock %}

{% block javascripts %}
{{ encore_entry_script_tags("search") }}
{{ encore_entry_script_tags("contribution") }}
{% endblock javascripts %}