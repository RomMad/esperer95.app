{% extends "base.html.twig" %}

{% block title %}Redevances | {{ title_website }}{% endblock %}

{% block body %}

<section class="mt-0">

    <div class="container">
        {% include "model/msgFlash.html.twig" %}
        <h1 class="h2 mb-4">Redevances</h1>
    </div>

    {% include "app/contribution/searchContribution.html.twig" %}

    <div class="container-fluid mt-4">

        <div class="row align-items-baseline">
            <div class="col-md-4 count align-middle mb-2">
                <span class="align-middle">Résultat : {{ contributions.getTotalItemCount|number_format(0,'', ' ')  }}<!--
                --> contribution{% if contributions.getTotalItemCount > 1 %}s{% endif %}.</span>
            </div>
            <div class="col-md-8">
                <div class="navigation">{{ knp_pagination_render(contributions) }}</div>
            </div>
        </div>

        <div class="table-responsive">
            <table id="table-contributions" class="table table-striped table-bordered table-hover text-dark">
                <thead>
                    <tr>
                        <th scope="col" class="align-middle th-w-20"></th>
                        <th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Suivi", "p.lastname") }}</th>
                        <th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Service", "s.name") }}</th>
                        <th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Mois concerné", "c.month") }}</th>
                        <th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Type", "c.type") }}</th>
                        <th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Montant dû", "c.dueAmt") }}</th>
                        <th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Montant réglé", "c.paidAmt") }}</th>
                        <th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Restant dû", "c.stillDueAmt") }}</th>
                        <th scope="col" class="align-middle th-date">{{ knp_pagination_sortable(contributions, "Date de règlement", "c.paymentDate") }}</th>
                        <th scope="col" class="align-middle th-w-100">{{ knp_pagination_sortable(contributions, "Mode de réglement", "c.paymentType") }}</th>
                        <th scope="col" class="align-middle th-w-120">{{ knp_pagination_sortable(contributions, "Commentaire", "c.comment") }}</th>
                    </tr>
                </thead>
                <tbody id="container-contributions">
                    {% for contribution in contributions %}
                        <tr>
                            <td scope="row" class="align-middle text-center">
                                <a class="btn btn-{{ theme_color }} btn-sm shadow"
                                    href="{{ path('support_contributions', {'id': contribution.supportGroup.id, 'contributionId': contribution.id}) }}" 
                                    data-placement="bottom" title="Voir la redevance"><span class="fas fa-eye"></span>
                                </a>
                            </td>
                            <td class="align-middle">
                                {% for supportPerson in contribution.supportGroup.supportPeople|filter(a => a.head == true) %}
                                    {{ supportPerson.person.fullname }}
                                {% endfor %}                     
                            </td>
                            <td class="align-middle">{{ contribution.supportGroup.service.name }}</td>
                            <td class="align-middle">{{ contribution.month|date("Y-m") }}</td>
                            <td class="align-middle">{{ contribution.typeToString }}</td>
                            <td class="align-middle text-right">{{ contribution.dueAmt|number_format(0, ",", " ") }} €</td>
                            <td class="align-middle text-right">{{ contribution.paidAmt|number_format(0, ",", " ") }} €</td>
                            <td class="align-middle text-right">{{ contribution.stillDueAmt|number_format(0, ",", " ") }} €</td>
                            <td class="align-middle text-center">{{ contribution.paymentDate ? contribution.paymentDate|date("d/m/Y") }}</td>
                            <td class="align-middle">{{ contribution.paymentTypeToString }}</td>
                            <td class="align-middle">{{ contribution.comment|slice(0,65) }}{% if contribution.comment|length > 70 %}...{% endif %}</td>                  
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="navigation">{{ knp_pagination_render(contributions) }}</div>

    </div>

</section>

{% endblock %}

{% block javascripts %}
{{ encore_entry_script_tags("search") }}
{% endblock javascripts %}